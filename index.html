<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>
            VW DEMO GUI
        </title>
        <link href="css/style.css" rel="stylesheet" type="text/css" />

        <style>
            #container {
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
            }
            #chart {
                width: 1050px;
                height: 750px;
                position: absolute;
                bottom: -50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
            #steering-wheel {
                width: 300px;
                height: 275px;
                background-image: url('pics/steering-wheel-state1.png');
                background-size: 300px;
                position: absolute;
                top: 23%;
                left: 50%;
                transform: translate(-50%, -50%);
            }
        </style>
    </head>

    <body>
        <div id="container">
            <div id="chart">
                <canvas id="myChart"></canvas>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                const ctx = document.getElementById('myChart');

                const chart1 = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['1', '2', '3', '4', '5', '6'],
                        datasets: [
                            {
                                label: 'Touch Value',
                                borderColor: 'red',
                                backgroundColor: 'rgba(255, 0, 0, 0.2)',
                                pointBackgroundColor: 'rgba(255, 0, 0, 0.2)',
                                yAxisID: 'y-axis',
                                data: [25, 23, 24, 22, 20, 24],
                            },
                            {
                                label: 'Light Touch Threshold',
                                borderColor: 'blue',
                                backgroundColor: 'rgba(0, 0, 255, 0.2)',
                                pointBackgroundColor: 'rgba(0, 0, 255, 0.2)',
                                yAxisID: 'y-axis',
                                data: [34, 34, 34, 34, 34, 34],
                            },
                            {
                                label: 'Strong Touch Threshold',
                                borderColor: 'green',
                                backgroundColor: 'rgba(0, 255, 0, 0.2)',
                                pointBackgroundColor: 'rgba(0, 255, 0, 0.2)',
                                yAxisID: 'y-axis',
                                data: [41, 41, 41, 41, 41, 41],
                            },
                        ],
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'right',
                                align: 'center',
                                reverse: true,
                                color: 'black',
                                labels: {
                                    padding: 20,
                                    boxWidth: 50,
                                    boxHeight: 40,
                                    useBorderRadius: false,
                                    font: {
                                        size: 17
                                    }
                                }
                            },
                            title: {
                                display: true,
                                text: '1 Zone HOD Touch Status',
                                padding: 20,
                                color: 'black',
                                font: {
                                    size: 34
                                }
                            },
                            subtitle: {
                                display: true,
                                text: 'Volkswagon Gen 2 Steering Wheel',
                                padding: 20,
                                font: {
                                    size: 20
                                }
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                text: 'Touch 1',
                                ticks: {
                                    // Include the units in the ticks
                                    callback: function(value, index, ticks) {
                                        return Chart.Ticks.formatters.numeric.apply(this, [value, index, ticks]) + ' sec'
                                    }
                                }
                            },
                            'y-axis': {
                                beginAtZero: true,
                                ticks: {
                                    // Include the units in the ticks
                                    callback: function(value, index, ticks) {
                                        return Chart.Ticks.formatters.numeric.apply(this, [value, index, ticks]) + ' ADC'
                                    }
                                }
                            }
                        }
                    }
                });

                // TODO Replace with CAN message updates
                function addData() {
                    chart1.data.labels.push('.');
                    chart1.data.datasets[0].data.push(20 + Math.random() * 5);
                    chart1.data.datasets[1].data.push('34');
                    chart1.data.datasets[2].data.push('41');
                    chart1.update('none');
                }

                // TODO fix shift so that x-axis labels shift numerically and don't reset
                function removeData() {
                    chart1.data.labels.shift();
                    chart1.data.datasets.forEach((dataset) => {
                        dataset.data.shift();
                    });
                    chart1.update('none');
                }
                
                setInterval(addData, 1000);
                setInterval(removeData, 1000);
            </script>
            <div id="steering-wheel">
                <script type="text/javascript" src="js/wheel-state.js"></script>
            </div>
        </div>
    </body>
</html>