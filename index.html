<!DOCTYPE html>
<html>
    <head>
        <meta charset=""utf-8">
        <meta name="viewport" content="width=device-width">
        <title>
            VW GUI
        </title>
        <link href="style.css" rel="stylesheet" type="text/css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>

    <body>
        <div class="container">
            <div class="graph">
                <canvas id="realTimeChart"></canvas>

                <script>
                    // Simulated CAN message data (replace with actual data source from RS485 CAN HAT
                    const graph_canData = [
                        {timestamp: new Date(), value1: 10, value2: 20, value3: 30},
                        // Add more data points as they arrive
                    ];

                    const ctx = document.getElementById('realTimeChart').getContext('2d');

                    const chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            datasets:[
                                {
                                    label: 'Touch Value',
                                    borderColor: 'red',
                                    backgroundColor: 'rgba(255, 0, 0, 0.2)',
                                    data: [],
                                },
                                {
                                    label: 'Light Touch Threshold',
                                    borderColor: 'blue',
                                    backgroundColor: 'rgba(0, 0, 255, 0.2)',
                                    data: [], 
                                },
                                {
                                    label: 'Strong Touch Threshold',
                                    borderColor: 'green',
                                    backgroundColor: 'rgba(0, 255, 0, 0.2)',
                                    data: [],
                                },
                            ],
                        },
                        options: {
                            scales: {
                                x: {
                                    type: 'time',
                                    time: {
                                        unit: 'second',
                                    },
                                },
                                y: {
                                    beginAtZero: true,
                                },
                            },
                        },
                    });

                    function updateChart() {
                        // Add new data points from the CAN messages
                        for (const dataPoint of graph_canData) {
                            chart.data.datasets[0].data.push({
                                x: dataPoint.timestamp,
                                y: dataPoint.value1,
                            });
                            chart.data.datasets[1].data.push({
                                x: dataPoint.timestamp,
                                y: dataPoint.value2,
                            });
                            chart.data.datasets[3].data.push({
                                x: dataPoint.timestamp,
                                y: dataPoint.value3,
                            });
                        }

                        // Update the chart
                        chart.update();

                        // Remove the processed data points to avoid excessive memory usage
                        graph_canData.splice(0, graph_canData.length);
                    }

                    // Call updateChart() periodically to update the chart with new data
                    setInterval(updateChart, 1000); // Update every second (adjust as needed)
                </script>
            </div>

            <div class="steering-wheel">
                <script>
                    // Function to update the steering wheel image based on CAN messages
                    function updateSteeringWheelImage(canData) {
                        const steeringWheel = document.getElementById('steering-wheel');
            
                        // Check the CAN message or data to determine the state
                        // For example, you can use a property in canData like "state" to indicate the state
                        const state = wheel_canData.state;
            
                        // Update the image based on the state
                        if (state === 'state1') {
                            steeringWheel.style.backgroundImage = "url('steering-wheel-state1.png')";
                        } else if (state === 'state2') {
                            steeringWheel.style.backgroundImage = "url('steering-wheel-state2.png')";
                        }
                    }
            
                    // Simulated CAN message data (replace with your actual data source)
                    const wheel_canData = {
                        state: 'state1', // Initial state
                    };
            
                    // Simulate receiving CAN messages and updating the image
                    setInterval(function () {
                        // Update the CAN data from your actual source
                        // For this example, we'll just toggle between state1 and state2
                        wheel_canData.state = wheel_canData.state === 'state1' ? 'state2' : 'state1';
                        updateSteeringWheelImage(wheel_canData);
                    }, 2000); // Update every 2 seconds (adjust as needed)
                </script>
            </div>
        </div>
    </body>
</html>